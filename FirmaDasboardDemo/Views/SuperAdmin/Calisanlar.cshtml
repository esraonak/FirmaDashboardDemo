@{
    ViewData["Title"] = "Çalışanlar";
    Layout = "~/Views/Shared/_SuperAdminLayout.cshtml";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Çalışan Listesi</h3>
    </div>
    <div class="card-body">
        <table id="calisanTablosu" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Ad Soyad</th>
                    <th>Email</th>
                    <th>Telefon</th>
                    <th>Firma</th>
                    <th>Aktif</th>
                    <th>İşlem</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<!-- ✅ Düzenleme Modal -->
<div class="modal fade" id="calisanDuzenleModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Çalışan Düzenle</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="duzenleId">
                <div class="form-group">
                    <label>Ad Soyad</label>
                    <input type="text" id="duzenleAd" class="form-control" />
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="duzenleEmail" class="form-control" />
                </div>
                <div class="form-group">
                    <label>Telefon</label>
                    <input type="text" id="duzenleTelefon" class="form-control" />
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="duzenleAktif">
                    <label class="form-check-label" for="duzenleAktif">Aktif mi?</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="calisanGuncelle()">Güncelle</button>
                <button class="btn btn-secondary" data-dismiss="modal">İptal</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            $('#calisanTablosu').DataTable({
                ajax: {
                    url: '/SuperAdmin/GetCalisanlar',
                    dataSrc: ''
                },
                columns: [
                    { data: 'adSoyad' },
                    { data: 'email' },
                    { data: 'telefon' },
                    { data: 'firmaAd' },
                    {
                        data: 'aktifMi',
                        render: function (data) {
                            return data ? 'Evet' : 'Hayır';
                        }
                    },
                    {
                        data: 'id',
                        render: function (id) {
                            return `
                                <button class="btn btn-warning btn-sm" onclick="calisanDuzenle(${id})">Düzenle</button>
                                <button class="btn btn-danger btn-sm" onclick="calisanSil(${id})">Sil</button>
                            `;
                        }
                    }
                ]
            });
        });

        function calisanDuzenle(id) {
            $.get('/SuperAdmin/CalisanGetir', { id: id }, function (data) {
                $('#duzenleId').val(data.id);
                $('#duzenleAd').val(data.adSoyad);
                $('#duzenleEmail').val(data.email);
                $('#duzenleTelefon').val(data.telefon);
                $('#duzenleAktif').prop('checked', data.aktifMi);
                $('#calisanDuzenleModal').modal('show');
            });
        }

        function calisanGuncelle() {
            var model = {
                id: $('#duzenleId').val(),
                adSoyad: $('#duzenleAd').val(),
                email: $('#duzenleEmail').val(),
                telefon: $('#duzenleTelefon').val(),
                aktifMi: $('#duzenleAktif').is(':checked')
            };

            $.post('/SuperAdmin/CalisanGuncelle', model, function (res) {
                if (res.success) {
                    $('#calisanDuzenleModal').modal('hide');
                    $('#calisanTablosu').DataTable().ajax.reload();
                } else {
                    alert("Güncelleme başarısız.");
                }
            });
        }

        function calisanSil(id) {
            if (confirm("Bu çalışanı pasif yapmak istiyor musunuz?")) {
                $.post('/SuperAdmin/CalisanPasifYap', { id: id }, function (res) {
                    if (res.success) {
                        $('#calisanTablosu').DataTable().ajax.reload();
                    } else {
                        alert("İşlem başarısız.");
                    }
                });
            }
        }
    </script>
}
