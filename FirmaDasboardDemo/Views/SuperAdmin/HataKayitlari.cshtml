@{
    ViewData["Title"] = "Hata Kayıtları";
    Layout = "~/Views/Shared/_SuperAdminLayout.cshtml";
}

<div class="container-fluid mt-4">
    <h3 class="mb-4">Hata Kayıtları</h3>
    <table id="hataTablosu" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Kullanıcı</th>
                <th>Rol</th>
                <th>Firma</th>
                <th>URL</th>
                <th>Tarih</th>
                <th>Açıklama</th>
                <th>İşlem</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

@section Scripts {
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function () {
            var table = $('#hataTablosu').DataTable({
                ajax: '/SuperAdmin/api/hatalar',
                columns: [
                    { data: 'id' },
                    { data: 'kullaniciAdi' },
                    { data: 'kullaniciRol' },
                    { data: 'firmaSeo' },
                    { data: 'url' },
                    { data: 'tarih' },
                    { data: 'aciklama' },
                    {
                        data: 'id',
                        render: function (data) {
                            return `<button class="btn btn-danger btn-sm sil-btn" data-id="${data}">Sil</button>`;
                        },
                        orderable: false
                    }
                ],
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.5/i18n/tr.json'
                }
            });

            // 🔴 Sil butonu click
            $('#hataTablosu').on('click', '.sil-btn', function () {
                const id = $(this).data('id');
                Swal.fire({
                    title: 'Silmek istediğinize emin misiniz?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Evet, sil',
                    cancelButtonText: 'Vazgeç'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.post('/SuperAdmin/api/hata-sil', { id: id }, function (res) {
                            if (res.status === 'success') {
                                table.ajax.reload();
                                Swal.fire('Silindi!', '', 'success');
                            }
                        });
                    }
                });
            });
        });
    </script>
}

